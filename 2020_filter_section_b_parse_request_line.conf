filter {
  if [type] == "mod_security" {
    #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    # Parse out fields from Section B (request related line 1)
    # note line one could be garbage OR adhere to the
    # httpMethod [space] uri [space] protocol pattern
    #~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

    # if a legit line... normal http request
    if [rawSectionB] =~ /.*?\s\S+\s.+\n{1}/ {

      grok {
        match => {
          "rawSectionB" => "%{DATA:httpMethod}\s(?<requestedUri>\S+)\s(?<incomingProtocol>.+?)\n{1}"
        }
        patterns_dir => "./patterns/logstash_modsecurity_patterns"
      }

    # not a legit line.. invalid http request, grab first line and dump in the httpMethod
    } else {

      grok {
        match => {
          "rawSectionB" => "(?<httpMethod>^(.*)$)"
        }
        patterns_dir => "./patterns/logstash_modsecurity_patterns"
      }
    }
  }
}